---
title: "Project"
author: Giovanni Billo, Muhammad Mubashar Shahzad, Carlos Velásquez Fernández, Fabio Vicig
date: "2025-01-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


The analysis is centered around the prediction of presence of cardiovascular disease, given data about patients. [TABLE OF CONTENTS, SUMMARY OF WHAT HAS BEEN DONE]

Firstly, an exploratory analysis has been conducted, with the purpose of identifying problems and have at a glance an idea of meaning and distribution of the variables.

```{r 'Explorative analysis and data cleaning'}
cardio_with_id <- read.csv("cardio_train.csv", sep= ";", header=TRUE)
cardio <- cardio_with_id[,-1]
sum(as.numeric(is.na(cardio)))
str(cardio)
summary(cardio)
par(mfrow = c(2,2))
```

The dataset contains 70000 observations of 12 variables. The source doesn't specify how the data was recovered or generated, and it has not been possible to find it elsewhere than Kaggle. The variables are the following:\
- **cardio** : objective variable of our analysis. \
- **age** : age of the patient, in days\
- **gender** : categorical variable which is 1 for females and 2 for males\
- **height** : height of the patient, in cm\
- **weight** : weight of the patient, in kg\
- **ap_hi** : systolic blood pressure\
- **ap_lo** : diastolic blood pressure\
- **cholesterol** : categorical variable with three levels of cholesterol: 1: normal, 2: above normal, 3: well above normal\
- **gluc** : categorical variable with three levels of glucose: 1: normal, 2: above normal, 3: well above normal\
- **smoke** : binary variable, representing smokers\
- **alco** : binary variable, representing alcohol intake\
- **active** : binary variable, representing physical activity\
The last three variables are marked as "subjective", which probably means they are judged with different metrics.\
\
There are no NA values. However, from the summary we can see that there are variables with impossible values: specifically, *ap_hi* and *ap_lo* have in some cases negative values, which don't make sense even for a dead person, and in other cases extremely high values.
"The highest pressure recorded in an individual was 370/360"
{DOI: 10.1016/s0003-9993(95)80578-8}

```{r}
summary(cardio[(cardio$ap_hi<0|cardio$ap_hi>400|cardio$ap_lo<0|cardio$ap_lo>400|cardio$ap_hi<cardio$ap_lo),])
cardio <- cardio[!(cardio$ap_hi < 0 | cardio$ap_hi > 400 | cardio$ap_lo < 0 | cardio$ap_lo > 400 | cardio$ap_hi < cardio$ap_lo),]
```

1274 observations have completely irrealistic values for either systolic or diastolic pressure (or both). It is less than 2% of our dataset, so the most straightforward approach is just to eliminate the problematic rows. Of this 1274, 274 were eliminated because in them systolic pressure was less than the diastolic.\

```{r}
cardio[c("gender", "cholesterol", "gluc", "smoke", "alco","active")] <- lapply(cardio[c("gender", "cholesterol", "gluc", "smoke", "alco","active")], factor)
cardio$gender <- factor(cardio$gender, levels = c("F", "M"))
cardio$cholesterol <- factor(cardio$cholesterol, levels = c("normal", "above normal", "well above normal"))
cardio$gluc <- factor(cardio$gluc, levels = c("normal", "above normal", "well above normal"))
```

```{r age_categorizing}
cardio$age = ceiling(cardio$age/365)
cardio$age_cat <- ifelse(cardio$age >= 18 & cardio$age <= 35, 'Y', 
                         ifelse(cardio$age > 35 & cardio$age <= 55, 'S', 'E'))
    
```

```{r}
library(corrplot)
library(reshape2)
library(ggplot2)
```


```{r}
numerical <- cardio[, c("age", "height", "weight", "ap_hi", "ap_lo")]
categorical <- cardio[!(names(cardio) %in% c("age", "height", "weight", "ap_hi", "ap_lo"))]
table(cardio$cardio)
```
The dataset is balanced with respect to the target variable.
```{r eval=FALSE, include=FALSE}
corrplot(cor(as.matrix(cardio), method='pearson'))
```

```{r pressure, eval=FALSE, include=FALSE}
#corrplot(cor(cardio))


pairs(cardio[c("age", "height", "weight", "ap_hi", "ap_lo")])
```
```{r eval=FALSE, include=FALSE}
pairs(numerical,
      labels = colnames(numerical),  
      pch = 21,
      bg = rainbow(2)[as.factor(cardio$cardio)],
      col = rainbow(2)[as.factor(cardio$cardio)], 
      main = "Cardiovascular disease dataset",
      row1attop = TRUE,         # If FALSE, changes the direction of the diagonal
      gap = 1,                  # Distance between subplots
      cex.labels = NULL,        # Size of the diagonal text
      font.labels = 1)
```

```{r eval=FALSE}
panel.hist <- function(x, ...) {
    usr <- par("usr")
    on.exit(par(usr))
    par(usr = c(usr[1:2], 0, 1.5))
    his <- hist(x, plot = FALSE)
    breaks <- his$breaks
    nB <- length(breaks)
    y <- his$counts
    y <- y/max(y)
    rect(breaks[-nB], 0, breaks[-1], y, col = rgb(0, 1, 1, alpha = 0.5), ...)
    # lines(density(x), col = 2, lwd = 2) # Uncomment to add density lines
}

# Creating the scatter plot matrix
pairs(numerical,
      upper.panel = NULL,         # Disabling the upper panel
      diag.panel = panel.hist)    # Adding the histograms
```




Correlation analysis

```{r}
cor_cardio = round(cor(as.data.frame(numerical)), 2)
melt_cardio = melt(cor_cardio)

ggplot(data = melt_cardio, aes(x=Var1, y=Var2, fill=value)) + 
  geom_tile() +
  geom_text(aes(Var2, Var1, label = value), size = 5) +
  scale_fill_gradient2(low = "blue", high = "red",
                       limit = c(-1,1), name="Correlation") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.background = element_blank())
```

```{r}
summary_table = as.data.frame(table(cardio$age_cat, cardio$cardio))
colnames(summary_table) <- c("age_cat", "cardio", "count")

ggplot(summary_table, aes(x = age_cat, y = count, fill = as.factor(cardio))) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Counts of cardio by Age Category",
    x = "Age Category",
    y = "Count",
    fill = "Cardio"
  ) +
  theme_minimal()

```
